<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Scrollbare Pose Trails</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Helvetica+Neue:wght@400;700&display=swap');
        
        body { 
            margin: 0; 
            background: #ffffff; 
            font-family: 'Helvetica Neue', sans-serif;
            height: 300vh;
        }
        canvas { 
            display: block; 
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            pointer-events: none;
            z-index: 1;
        }
        .panel {
            position: relative;
            z-index: 2;
            width: 80vw;
            height: 60vh;
            max-width: 800px;
            margin: 100px auto;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* Zeigt, dass es klickbar ist */
            transition: transform 0.2s ease;
        }
        .panel:active {
            transform: scale(0.98); /* Feedback beim Klicken */
        }
        .panel h1 {
            font-size: 5vw;
            font-weight: 700;
            margin: 0;
            letter-spacing: 2px;
        }
        #debug {
            position: fixed;
            bottom: 20px;
            right: 20px;
            color: #666;
            font-family: 'Helvetica Neue', sans-serif;
            font-size: 12px;
            font-weight: 400;
            background: rgba(255,255,255,0.8);
            padding: 8px 12px;
            border-radius: 20px;
            backdrop-filter: blur(10px);
            z-index: 100;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        
        #debug:hover {
            opacity: 1;
        }
        
        .panel:first-of-type {
            height: 100vh;
            margin: 0;
            width: 100vw;
            max-width: none;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        /* Mobile Optimierungen */
        @media (max-width: 768px) {
            .panel h1 {
                font-size: 8vw; /* Größere Schrift auf Mobile */
            }
            .panel {
                width: 90vw;
                height: 50vh;
                margin: 60px auto;
            }
            #debug {
                font-size: 10px;
                padding: 6px 10px;
                bottom: 15px;
                right: 15px;
            }
        }
    </style>
</head>
<body>
    
    <div id="debug">Warte auf Pose-Erkennung...</div>
    
    <canvas id="pose-canvas"></canvas>
    <video id="webcam" style="display: none;"></video>
    
    <div class="panel" style="color: rgb(255, 0, 0);" onclick="openCV()">
        <h1>JOSHUA LIECK</h1>
    </div>
    
    <div class="panel" style="color: rgb(0, 255, 0);" onclick="openCV()">
        <h1>JOSHUA LIECK</h1>
    </div>
    
    <div class="panel" style="color: rgb(0, 0, 255);" onclick="openCV()">
        <h1>JOSHUA LIECK</h1>
    </div>

    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/control_utils/control_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/drawing_utils/drawing_utils.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/pose/pose.js"></script>

    <script>
        // CV öffnen Funktion
        function openCV() {
            window.open('CV25.pdf', '_blank');
        }

        // Debug-Element
        const debugEl = document.getElementById('debug');
        
        // Canvas Setup
        const canvas = document.getElementById('pose-canvas');
        const ctx = canvas.getContext('2d');
        
        // Canvas-Größe anpassen und Hintergrund zeichnen
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            ctx.fillStyle = '#ffffff';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
        }
        resizeCanvas();
        window.addEventListener('resize', resizeCanvas);
        
        // Trail-System für verschiedene Körperteile
        const poseTrails = {
            nose: [],
            leftShoulder: [],
            rightShoulder: [],
            leftElbow: [],
            rightElbow: [],
            leftWrist: [],
            rightWrist: [],
            leftHip: [],
            rightHip: [],
            leftKnee: [],
            rightKnee: [],
            leftAnkle: [],
            rightAnkle: []
        };
        
        // Mobile-optimierte MediaPipe Pose Setup
        const pose = new Pose({
            locateFile: (file) => `https://cdn.jsdelivr.net/npm/@mediapipe/pose/${file}`
        });
        
        // Mobile-spezifische Einstellungen
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        
        pose.setOptions({
            modelComplexity: isMobile ? 0 : 1, // Einfachere Erkennung auf Mobile
            smoothLandmarks: true,
            minDetectionConfidence: isMobile ? 0.7 : 0.5, // Höhere Konfidenz auf Mobile
            minTrackingConfidence: isMobile ? 0.7 : 0.5
        });
        
        pose.onResults((results) => {
            if (results.poseLandmarks) {
                debugEl.textContent = "Pose erkannt!";
                
                const landmarks = results.poseLandmarks;
                
                updateTrail('nose', landmarks[0]);
                updateTrail('leftShoulder', landmarks[11]);
                updateTrail('rightShoulder', landmarks[12]);
                updateTrail('leftElbow', landmarks[13]);
                updateTrail('rightElbow', landmarks[14]);
                updateTrail('leftWrist', landmarks[15]);
                updateTrail('rightWrist', landmarks[16]);
                updateTrail('leftHip', landmarks[23]);
                updateTrail('rightHip', landmarks[24]);
                updateTrail('leftKnee', landmarks[25]);
                updateTrail('rightKnee', landmarks[26]);
                updateTrail('leftAnkle', landmarks[27]);
                updateTrail('rightAnkle', landmarks[28]);
                
            } else {
                debugEl.textContent = "Keine Pose erkannt";
            }
        });
        
        function updateTrail(trailName, landmark) {
            if (landmark && landmark.visibility > 0.5) {
                const x = landmark.x * canvas.width;
                const y = landmark.y * canvas.height;
                
                poseTrails[trailName].push({x, y});
                
                if (poseTrails[trailName].length > 1) {
                    const prevPoint = poseTrails[trailName][poseTrails[trailName].length - 2];
                    const currPoint = poseTrails[trailName][poseTrails[trailName].length - 1];
                    
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = isMobile ? 2 : 3; // Dünnere Linien auf Mobile
                    ctx.lineCap = 'round';
                    ctx.lineJoin = 'round';
                    
                    ctx.beginPath();
                    ctx.moveTo(prevPoint.x, prevPoint.y);
                    ctx.lineTo(currPoint.x, currPoint.y);
                    ctx.stroke();
                }
            }
        }
        
        // Mobile-optimierte Webcam
        const webcam = new Camera(document.getElementById('webcam'), {
            onFrame: async () => {
                await pose.send({image: document.getElementById('webcam')});
            },
            width: isMobile ? 320 : 640, // Kleinere Auflösung auf Mobile
            height: isMobile ? 240 : 480,
            fps: isMobile ? 15 : 30 // Reduzierte FPS auf Mobile für bessere Batterie
        });
        
        webcam.start().then(() => {
            debugEl.textContent = "Webcam aktiviert - Warte auf Pose...";
        }).catch(err => {
            debugEl.textContent = "Webcam-Fehler: " + err.message;
        });
        
        // Canvas leeren mit 'c' Taste
        document.addEventListener('keydown', (e) => {
            if (e.key === 'c' || e.key === 'C') {
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                for (const trailName in poseTrails) {
                    poseTrails[trailName] = [];
                }
                
                debugEl.textContent = "Canvas geleert (C-Taste)";
            }
        });
        
        // Touch-optimiertes Scrolling
        let lastScrollY = window.scrollY;
        let isScrolling = false;
        
        function handleScroll() {
            if (isScrolling) return;
            isScrolling = true;
            
            const currentScrollY = window.scrollY;
            const scrollDirection = currentScrollY > lastScrollY ? 'down' : 'up';
            const scrollDistance = Math.abs(currentScrollY - lastScrollY);
            
            for (const trailName in poseTrails) {
                const trail = poseTrails[trailName];
                if (trail.length > 0) {
                    const lastPoint = trail[trail.length - 1];
                    
                    ctx.strokeStyle = '#000000';
                    ctx.lineWidth = isMobile ? 2 : 3;
                    ctx.lineCap = 'round';
                    
                    ctx.beginPath();
                    ctx.moveTo(lastPoint.x, lastPoint.y);
                    
                    if (scrollDirection === 'down') {
                        ctx.lineTo(lastPoint.x, lastPoint.y + scrollDistance);
                    } else {
                        ctx.lineTo(lastPoint.x, lastPoint.y - scrollDistance);
                    }
                    
                    ctx.stroke();
                    
                    if (scrollDirection === 'down') {
                        lastPoint.y += scrollDistance;
                    } else {
                        lastPoint.y -= scrollDistance;
                    }
                }
            }
            
            lastScrollY = currentScrollY;
            
            setTimeout(() => {
                isScrolling = false;
            }, isMobile ? 50 : 16); // Langsamere Updates auf Mobile
        }
        
        // Scroll-Event mit Throttling für Mobile
        window.addEventListener('scroll', handleScroll, { passive: true });
        
        // Touch-Events für Mobile
        if (isMobile) {
            let touchStartY = 0;
            let touchStartTime = 0;
            
            document.addEventListener('touchstart', (e) => {
                touchStartY = e.touches[0].clientY;
                touchStartTime = Date.now();
            }, { passive: true });
            
            document.addEventListener('touchend', (e) => {
                const touchEndY = e.changedTouches[0].clientY;
                const touchEndTime = Date.now();
                const touchDuration = touchEndTime - touchStartTime;
                
                // Schneller Tap öffnet CV
                if (touchDuration < 300 && Math.abs(touchEndY - touchStartY) < 10) {
                    const clickedElement = document.elementFromPoint(e.changedTouches[0].clientX, e.changedTouches[0].clientY);
                    if (clickedElement && clickedElement.closest('.panel')) {
                        openCV();
                    }
                }
            }, { passive: true });
        }
    </script>
    
    <script>
        // Zufällige Farben für Joshua Lieck Panels beim Laden
        function randomColor() {
            const r = Math.floor(Math.random() * 256);
            const g = Math.floor(Math.random() * 256);
            const b = Math.floor(Math.random() * 256);
            return `rgb(${r}, ${g}, ${b})`;
        }
        
        window.addEventListener('load', () => {
            const panels = document.querySelectorAll('.panel');
            panels.forEach(panel => {
                panel.style.color = randomColor();
            });
            if (panels.length > 0) {
                sessionStorage.setItem('nameColor', panels[0].style.color);
            }
        });
    </script>
    
    <script>
        // Unendliche Panels mit zufälligen Farben hinzufügen
        function createPanel() {
            const panel = document.createElement('div');
            panel.className = 'panel';
            panel.style.color = randomColor();
            panel.onclick = openCV; // Alle neuen Panels sind auch klickbar
            const h1 = document.createElement('h1');
            h1.textContent = 'JOSHUA LIECK';
            panel.appendChild(h1);
            return panel;
        }

        let isAppending = false;
        function maybeAppendPanels() {
            if (isAppending) return;
            const nearBottom = window.scrollY + window.innerHeight > document.documentElement.scrollHeight - 800;
            if (!nearBottom) return;
            isAppending = true;
            for (let i = 0; i < 5; i += 1) {
                document.body.appendChild(createPanel());
            }
            isAppending = false;
        }

        window.addEventListener('scroll', maybeAppendPanels);
        window.addEventListener('load', () => {
            for (let i = 0; i < 3; i += 1) document.body.appendChild(createPanel());
        });
    </script>
</body>
</html>
